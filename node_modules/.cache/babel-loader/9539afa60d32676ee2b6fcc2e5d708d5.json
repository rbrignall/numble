{"ast":null,"code":"import { extends as _extends, objectWithoutPropertiesLoose as _objectWithoutPropertiesLoose } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport React, { useReducer, createRef, useMemo, createContext, useCallback, useEffect, useRef, useContext, Fragment } from 'react';\nimport { match } from '../../utils/match.esm.js';\nimport { render, forwardRefWithAs, Features } from '../../utils/render.esm.js';\nimport { useSyncRefs } from '../../hooks/use-sync-refs.esm.js';\nimport { Keys } from '../keyboard.esm.js';\nimport { isDisabledReactIssue7711 } from '../../utils/bugs.esm.js';\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect.esm.js';\nimport { useId } from '../../hooks/use-id.esm.js';\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management.esm.js';\nimport { useWindowEvent } from '../../hooks/use-window-event.esm.js';\nimport { OpenClosedProvider, State, useOpenClosed } from '../../internal/open-closed.esm.js';\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type.esm.js';\nimport { disposables } from '../../utils/disposables.esm.js';\nimport { useDisposables } from '../../hooks/use-disposables.esm.js';\nimport { calculateActiveIndex, Focus } from '../../utils/calculate-active-index.esm.js';\nimport { useTreeWalker } from '../../hooks/use-tree-walker.esm.js';\n\nvar _reducers;\n\nvar MenuStates;\n\n(function (MenuStates) {\n  MenuStates[MenuStates[\"Open\"] = 0] = \"Open\";\n  MenuStates[MenuStates[\"Closed\"] = 1] = \"Closed\";\n})(MenuStates || (MenuStates = {}));\n\nvar ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"OpenMenu\"] = 0] = \"OpenMenu\";\n  ActionTypes[ActionTypes[\"CloseMenu\"] = 1] = \"CloseMenu\";\n  ActionTypes[ActionTypes[\"GoToItem\"] = 2] = \"GoToItem\";\n  ActionTypes[ActionTypes[\"Search\"] = 3] = \"Search\";\n  ActionTypes[ActionTypes[\"ClearSearch\"] = 4] = \"ClearSearch\";\n  ActionTypes[ActionTypes[\"RegisterItem\"] = 5] = \"RegisterItem\";\n  ActionTypes[ActionTypes[\"UnregisterItem\"] = 6] = \"UnregisterItem\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar reducers = (_reducers = {}, _reducers[ActionTypes.CloseMenu] = function (state) {\n  if (state.menuState === MenuStates.Closed) return state;\n  return _extends({}, state, {\n    activeItemIndex: null,\n    menuState: MenuStates.Closed\n  });\n}, _reducers[ActionTypes.OpenMenu] = function (state) {\n  if (state.menuState === MenuStates.Open) return state;\n  return _extends({}, state, {\n    menuState: MenuStates.Open\n  });\n}, _reducers[ActionTypes.GoToItem] = function (state, action) {\n  var activeItemIndex = calculateActiveIndex(action, {\n    resolveItems: function resolveItems() {\n      return state.items;\n    },\n    resolveActiveIndex: function resolveActiveIndex() {\n      return state.activeItemIndex;\n    },\n    resolveId: function resolveId(item) {\n      return item.id;\n    },\n    resolveDisabled: function resolveDisabled(item) {\n      return item.dataRef.current.disabled;\n    }\n  });\n  if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state;\n  return _extends({}, state, {\n    searchQuery: '',\n    activeItemIndex: activeItemIndex\n  });\n}, _reducers[ActionTypes.Search] = function (state, action) {\n  var searchQuery = state.searchQuery + action.value.toLowerCase();\n  var match = state.items.findIndex(function (item) {\n    var _item$dataRef$current;\n\n    return ((_item$dataRef$current = item.dataRef.current.textValue) == null ? void 0 : _item$dataRef$current.startsWith(searchQuery)) && !item.dataRef.current.disabled;\n  });\n  if (match === -1 || match === state.activeItemIndex) return _extends({}, state, {\n    searchQuery: searchQuery\n  });\n  return _extends({}, state, {\n    searchQuery: searchQuery,\n    activeItemIndex: match\n  });\n}, _reducers[ActionTypes.ClearSearch] = function (state) {\n  if (state.searchQuery === '') return state;\n  return _extends({}, state, {\n    searchQuery: ''\n  });\n}, _reducers[ActionTypes.RegisterItem] = function (state, action) {\n  return _extends({}, state, {\n    items: [].concat(state.items, [{\n      id: action.id,\n      dataRef: action.dataRef\n    }])\n  });\n}, _reducers[ActionTypes.UnregisterItem] = function (state, action) {\n  var nextItems = state.items.slice();\n  var currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null;\n  var idx = nextItems.findIndex(function (a) {\n    return a.id === action.id;\n  });\n  if (idx !== -1) nextItems.splice(idx, 1);\n  return _extends({}, state, {\n    items: nextItems,\n    activeItemIndex: function () {\n      if (idx === state.activeItemIndex) return null;\n      if (currentActiveItem === null) return null; // If we removed the item before the actual active index, then it would be out of sync. To\n      // fix this, we will find the correct (new) index position.\n\n      return nextItems.indexOf(currentActiveItem);\n    }()\n  });\n}, _reducers);\nvar MenuContext = /*#__PURE__*/createContext(null);\nMenuContext.displayName = 'MenuContext';\n\nfunction useMenuContext(component) {\n  var context = useContext(MenuContext);\n\n  if (context === null) {\n    var err = new Error(\"<\" + component + \" /> is missing a parent <\" + Menu.name + \" /> component.\");\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext);\n    throw err;\n  }\n\n  return context;\n}\n\nfunction stateReducer(state, action) {\n  return match(action.type, reducers, state, action);\n} // ---\n\n\nvar DEFAULT_MENU_TAG = Fragment;\n\nfunction Menu(props) {\n  var _match;\n\n  var reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null\n  });\n  var _reducerBag$ = reducerBag[0],\n      menuState = _reducerBag$.menuState,\n      itemsRef = _reducerBag$.itemsRef,\n      buttonRef = _reducerBag$.buttonRef,\n      dispatch = reducerBag[1]; // Handle outside click\n\n  useWindowEvent('mousedown', function (event) {\n    var _buttonRef$current, _itemsRef$current;\n\n    var target = event.target;\n    if (menuState !== MenuStates.Open) return;\n    if ((_buttonRef$current = buttonRef.current) == null ? void 0 : _buttonRef$current.contains(target)) return;\n    if ((_itemsRef$current = itemsRef.current) == null ? void 0 : _itemsRef$current.contains(target)) return;\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      var _buttonRef$current2;\n\n      event.preventDefault();\n      (_buttonRef$current2 = buttonRef.current) == null ? void 0 : _buttonRef$current2.focus();\n    }\n  });\n  var slot = useMemo(function () {\n    return {\n      open: menuState === MenuStates.Open\n    };\n  }, [menuState]);\n  return React.createElement(MenuContext.Provider, {\n    value: reducerBag\n  }, React.createElement(OpenClosedProvider, {\n    value: match(menuState, (_match = {}, _match[MenuStates.Open] = State.Open, _match[MenuStates.Closed] = State.Closed, _match))\n  }, render({\n    props: props,\n    slot: slot,\n    defaultTag: DEFAULT_MENU_TAG,\n    name: 'Menu'\n  })));\n} // ---\n\n\nvar DEFAULT_BUTTON_TAG = 'button';\nvar Button = /*#__PURE__*/forwardRefWithAs(function Button(props, ref) {\n  var _state$itemsRef$curre;\n\n  var _useMenuContext = useMenuContext([Menu.name, Button.name].join('.')),\n      state = _useMenuContext[0],\n      dispatch = _useMenuContext[1];\n\n  var buttonRef = useSyncRefs(state.buttonRef, ref);\n  var id = \"headlessui-menu-button-\" + useId();\n  var d = useDisposables();\n  var handleKeyDown = useCallback(function (event) {\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n      case Keys.Space:\n      case Keys.Enter:\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.First\n          });\n        });\n        break;\n\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.Last\n          });\n        });\n        break;\n    }\n  }, [dispatch, d]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var handleClick = useCallback(function (event) {\n    if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault();\n    if (props.disabled) return;\n\n    if (state.menuState === MenuStates.Open) {\n      dispatch({\n        type: ActionTypes.CloseMenu\n      });\n      d.nextFrame(function () {\n        var _state$buttonRef$curr;\n\n        return (_state$buttonRef$curr = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr.focus({\n          preventScroll: true\n        });\n      });\n    } else {\n      event.preventDefault();\n      event.stopPropagation();\n      dispatch({\n        type: ActionTypes.OpenMenu\n      });\n    }\n  }, [dispatch, d, state, props.disabled]);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var passthroughProps = props;\n  var propsWeControl = {\n    ref: buttonRef,\n    id: id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': (_state$itemsRef$curre = state.itemsRef.current) == null ? void 0 : _state$itemsRef$curre.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button'\n  });\n}); // ---\n\nvar DEFAULT_ITEMS_TAG = 'div';\nvar ItemsRenderFeatures = Features.RenderStrategy | Features.Static;\nvar Items = /*#__PURE__*/forwardRefWithAs(function Items(props, ref) {\n  var _state$items$state$ac, _state$buttonRef$curr4;\n\n  var _useMenuContext2 = useMenuContext([Menu.name, Items.name].join('.')),\n      state = _useMenuContext2[0],\n      dispatch = _useMenuContext2[1];\n\n  var itemsRef = useSyncRefs(state.itemsRef, ref);\n  var id = \"headlessui-menu-items-\" + useId();\n  var searchDisposables = useDisposables();\n  var usesOpenClosedState = useOpenClosed();\n\n  var visible = function () {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open;\n    }\n\n    return state.menuState === MenuStates.Open;\n  }();\n\n  useEffect(function () {\n    var container = state.itemsRef.current;\n    if (!container) return;\n    if (state.menuState !== MenuStates.Open) return;\n    if (container === document.activeElement) return;\n    container.focus({\n      preventScroll: true\n    });\n  }, [state.menuState, state.itemsRef]);\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept: function accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT;\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP;\n      return NodeFilter.FILTER_ACCEPT;\n    },\n    walk: function walk(node) {\n      node.setAttribute('role', 'none');\n    }\n  });\n  var handleKeyDown = useCallback(function (event) {\n    searchDisposables.dispose();\n\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n      // @ts-expect-error Fallthrough is expected here\n      case Keys.Space:\n        if (state.searchQuery !== '') {\n          event.preventDefault();\n          event.stopPropagation();\n          return dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n        }\n\n      // When in type ahead mode, fallthrough\n\n      case Keys.Enter:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n\n        if (state.activeItemIndex !== null) {\n          var _document$getElementB;\n\n          var _id = state.items[state.activeItemIndex].id;\n          (_document$getElementB = document.getElementById(_id)) == null ? void 0 : _document$getElementB.click();\n        }\n\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr2;\n\n          return (_state$buttonRef$curr2 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr2.focus({\n            preventScroll: true\n          });\n        });\n        break;\n\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Next\n        });\n\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Previous\n        });\n\n      case Keys.Home:\n      case Keys.PageUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.First\n        });\n\n      case Keys.End:\n      case Keys.PageDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Last\n        });\n\n      case Keys.Escape:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr3;\n\n          return (_state$buttonRef$curr3 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr3.focus({\n            preventScroll: true\n          });\n        });\n        break;\n\n      case Keys.Tab:\n        event.preventDefault();\n        event.stopPropagation();\n        break;\n\n      default:\n        if (event.key.length === 1) {\n          dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n          searchDisposables.setTimeout(function () {\n            return dispatch({\n              type: ActionTypes.ClearSearch\n            });\n          }, 350);\n        }\n\n        break;\n    }\n  }, [dispatch, searchDisposables, state]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var propsWeControl = {\n    'aria-activedescendant': state.activeItemIndex === null ? undefined : (_state$items$state$ac = state.items[state.activeItemIndex]) == null ? void 0 : _state$items$state$ac.id,\n    'aria-labelledby': (_state$buttonRef$curr4 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr4.id,\n    id: id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef\n  };\n  var passthroughProps = props;\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible: visible,\n    name: 'Menu.Items'\n  });\n}); // ---\n\nvar DEFAULT_ITEM_TAG = Fragment;\n\nfunction Item(props) {\n  var _props$disabled = props.disabled,\n      disabled = _props$disabled === void 0 ? false : _props$disabled,\n      onClick = props.onClick,\n      passthroughProps = _objectWithoutPropertiesLoose(props, [\"disabled\", \"onClick\"]);\n\n  var _useMenuContext3 = useMenuContext([Menu.name, Item.name].join('.')),\n      state = _useMenuContext3[0],\n      dispatch = _useMenuContext3[1];\n\n  var id = \"headlessui-menu-item-\" + useId();\n  var active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false;\n  useIsoMorphicEffect(function () {\n    if (state.menuState !== MenuStates.Open) return;\n    if (!active) return;\n    var d = disposables();\n    d.nextFrame(function () {\n      var _document$getElementB2;\n\n      return (_document$getElementB2 = document.getElementById(id)) == null ? void 0 : _document$getElementB2.scrollIntoView == null ? void 0 : _document$getElementB2.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n    return d.dispose;\n  }, [id, active, state.menuState]);\n  var bag = useRef({\n    disabled: disabled\n  });\n  useIsoMorphicEffect(function () {\n    bag.current.disabled = disabled;\n  }, [bag, disabled]);\n  useIsoMorphicEffect(function () {\n    var _document$getElementB3, _document$getElementB4;\n\n    bag.current.textValue = (_document$getElementB3 = document.getElementById(id)) == null ? void 0 : (_document$getElementB4 = _document$getElementB3.textContent) == null ? void 0 : _document$getElementB4.toLowerCase();\n  }, [bag, id]);\n  useIsoMorphicEffect(function () {\n    dispatch({\n      type: ActionTypes.RegisterItem,\n      id: id,\n      dataRef: bag\n    });\n    return function () {\n      return dispatch({\n        type: ActionTypes.UnregisterItem,\n        id: id\n      });\n    };\n  }, [bag, id]);\n  var handleClick = useCallback(function (event) {\n    if (disabled) return event.preventDefault();\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n    disposables().nextFrame(function () {\n      var _state$buttonRef$curr5;\n\n      return (_state$buttonRef$curr5 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr5.focus({\n        preventScroll: true\n      });\n    });\n    if (onClick) return onClick(event);\n  }, [dispatch, state.buttonRef, disabled, onClick]);\n  var handleFocus = useCallback(function () {\n    if (disabled) return dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, id, dispatch]);\n  var handleMove = useCallback(function () {\n    if (disabled) return;\n    if (active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, active, id, dispatch]);\n  var handleLeave = useCallback(function () {\n    if (disabled) return;\n    if (!active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n  }, [disabled, active, dispatch]);\n  var slot = useMemo(function () {\n    return {\n      active: active,\n      disabled: disabled\n    };\n  }, [active, disabled]);\n  var propsWeControl = {\n    id: id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item'\n  });\n} // ---\n\n\nMenu.Button = Button;\nMenu.Items = Items;\nMenu.Item = Item;\nexport { Menu };","map":{"version":3,"sources":["/Users/rbrignall/Documents/GitHub/numble/node_modules/@headlessui/react/src/components/menu/menu.tsx"],"names":["MenuStates","ActionTypes","reducers","state","activeItemIndex","menuState","Closed","Open","calculateActiveIndex","resolveItems","resolveActiveIndex","resolveId","item","resolveDisabled","searchQuery","action","match","items","id","dataRef","nextItems","currentActiveItem","idx","a","MenuContext","createContext","context","useContext","err","Menu","Error","DEFAULT_MENU_TAG","props","reducerBag","useReducer","buttonRef","createRef","itemsRef","dispatch","useWindowEvent","target","event","type","CloseMenu","isFocusableElement","FocusableMode","slot","useMemo","open","value","State","render","defaultTag","name","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","useMenuContext","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","Keys","OpenMenu","focus","Focus","First","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","preventScroll","passthroughProps","propsWeControl","ref","useResolveButtonType","onKeyDown","onKeyUp","onClick","DEFAULT_ITEMS_TAG","ItemsRenderFeatures","Features","Items","searchDisposables","usesOpenClosedState","useOpenClosed","visible","useEffect","container","document","useTreeWalker","enabled","accept","node","NodeFilter","walk","key","disposables","Next","Previous","ClearSearch","role","tabIndex","features","DEFAULT_ITEM_TAG","disabled","Item","active","useIsoMorphicEffect","block","bag","useRef","handleFocus","Nothing","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":";;;;;;;;;;;;;;;;;;;;AAsCA,IAAA,UAAA;;AAAA,CAAA,UAAKA,UAAL,EAAKA;AACHA,EAAAA,UAAAA,CAAAA,UAAAA,CAAAA,MAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,MAAAA;AACAA,EAAAA,UAAAA,CAAAA,UAAAA,CAAAA,QAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,QAAAA;AAFF,CAAA,EAAKA,UAAU,KAAVA,UAAU,GAAf,EAAe,CAAf;;AAgBA,IAAA,WAAA;;AAAA,CAAA,UAAKC,WAAL,EAAKA;AACHA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,UAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,UAAAA;AACAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,WAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,WAAAA;AAEAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,UAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,UAAAA;AACAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,QAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,QAAAA;AACAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,aAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,aAAAA;AACAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,cAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,cAAAA;AACAA,EAAAA,WAAAA,CAAAA,WAAAA,CAAAA,gBAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,gBAAAA;AARF,CAAA,EAAKA,WAAW,KAAXA,WAAW,GAAhB,EAAgB,CAAhB;;AAqBA,IAAIC,QAAQ,IAAA,SAAA,GAAA,EAAA,EAAA,SAAA,CAMTD,WAAW,CANF,SAAA,CAAA,GAAA,UAAA,KAAA,EAAA;AAOR,MAAIE,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAAlC,MAAA,EAA2C,OAAA,KAAA;AAC3C,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBI,IAAAA,eAAe,EAAlC,IAAA;AAA0CC,IAAAA,SAAS,EAAEL,UAAU,CAACM;AAAhE,GAAA,CAAA;AARQ,CAAA,EAAA,SAAA,CAUTL,WAAW,CAVF,QAAA,CAAA,GAAA,UAAA,KAAA,EAAA;AAWR,MAAIE,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAAlC,IAAA,EAAyC,OAAA,KAAA;AACzC,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBK,IAAAA,SAAS,EAAEL,UAAU,CAACO;AAAzC,GAAA,CAAA;AAZQ,CAAA,EAAA,SAAA,CAcTN,WAAW,CAdF,QAAA,CAAA,GAcc,UAAA,KAAA,EAAA,MAAA,EAAA;AACtB,MAAIG,eAAe,GAAGI,oBAAoB,CAAA,MAAA,EAAS;AACjDC,IAAAA,YAAY,EAAE,SAAA,YAAA,GAAA;AAAA,aAAMN,KAAK,CAAX,KAAA;AADmC,KAAA;AAEjDO,IAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAA;AAAA,aAAMP,KAAK,CAAX,eAAA;AAF6B,KAAA;AAGjDQ,IAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,IAAA,EAAI;AAAA,aAAIC,IAAI,CAAR,EAAA;AAHkC,KAAA;AAIjDC,IAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,IAAA,EAAI;AAAA,aAAID,IAAI,CAAJA,OAAAA,CAAAA,OAAAA,CAAJ,QAAA;AAAA;AAJ4B,GAAT,CAA1C;AAOA,MAAIT,KAAK,CAALA,WAAAA,KAAAA,EAAAA,IAA4BA,KAAK,CAALA,eAAAA,KAAhC,eAAA,EAA2E,OAAA,KAAA;AAC3E,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBW,IAAAA,WAAW,EAA9B,EAAA;AAAoCV,IAAAA,eAAe,EAAfA;AAApC,GAAA,CAAA;AAvBQ,CAAA,EAAA,SAAA,CAyBTH,WAAW,CAzBF,MAAA,CAAA,GAyBY,UAAA,KAAA,EAAA,MAAA,EAAA;AACpB,MAAIa,WAAW,GAAGX,KAAK,CAALA,WAAAA,GAAoBY,MAAM,CAANA,KAAAA,CAAtC,WAAsCA,EAAtC;AACA,MAAIC,KAAK,GAAG,KAAK,CAAL,KAAA,CAAA,SAAA,CACV,UAAA,IAAA,EAAI;AAAA,QAAA,qBAAA;;AAAA,WACF,CAAA,CAAA,qBAAA,GAAA,IAAI,CAAJ,OAAA,CAAA,OAAA,CAAA,SAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,UAAA,CAAA,WAAA,CAAA,KAA2D,CAACJ,IAAI,CAAJA,OAAAA,CAAAA,OAAAA,CAD1D,QAAA;AADN,GAAY,CAAZ;AAKA,MAAII,KAAK,KAAK,CAAVA,CAAAA,IAAgBA,KAAK,KAAKb,KAAK,CAAnC,eAAA,EAAqD,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBW,IAAAA,WAAW,EAAXA;AAAnB,GAAA,CAAA;AACrD,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBA,IAAAA,WAAW,EAA9B,WAAA;AAAgCV,IAAAA,eAAe,EAAEY;AAAjD,GAAA,CAAA;AAjCQ,CAAA,EAAA,SAAA,CAmCTf,WAAW,CAnCF,WAAA,CAAA,GAAA,UAAA,KAAA,EAAA;AAoCR,MAAIE,KAAK,CAALA,WAAAA,KAAJ,EAAA,EAA8B,OAAA,KAAA;AAC9B,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAAmBW,IAAAA,WAAW,EAAE;AAAhC,GAAA,CAAA;AArCQ,CAAA,EAAA,SAAA,CAuCTb,WAAW,CAvCF,YAAA,CAAA,GAuCkB,UAAA,KAAA,EAAA,MAAA,EAAA;AAAA,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAE1BgB,IAAAA,KAAK,EAAA,GAAA,MAAA,CAAMd,KAAK,CAAX,KAAA,EAAA,CAAmB;AAAEe,MAAAA,EAAE,EAAEH,MAAM,CAAZ,EAAA;AAAiBI,MAAAA,OAAO,EAAEJ,MAAM,CAACI;AAAjC,KAAnB,CAAA;AAFqB,GAAA,CAAA;AAvClB,CAAA,EAAA,SAAA,CA2CTlB,WAAW,CA3CF,cAAA,CAAA,GA2CoB,UAAA,KAAA,EAAA,MAAA,EAAA;AAC5B,MAAImB,SAAS,GAAGjB,KAAK,CAALA,KAAAA,CAAhB,KAAgBA,EAAhB;AACA,MAAIkB,iBAAiB,GAAGlB,KAAK,CAALA,eAAAA,KAAAA,IAAAA,GAAiCiB,SAAS,CAACjB,KAAK,CAAhDA,eAA0C,CAA1CA,GAAxB,IAAA;AAEA,MAAImB,GAAG,GAAG,SAAS,CAAT,SAAA,CAAoB,UAAA,CAAA,EAAC;AAAA,WAAIC,CAAC,CAADA,EAAAA,KAASR,MAAM,CAAnB,EAAA;AAA/B,GAAU,CAAV;AAEA,MAAIO,GAAG,KAAK,CAAZ,CAAA,EAAgBF,SAAS,CAATA,MAAAA,CAAAA,GAAAA,EAAAA,CAAAA;AAEhB,SAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;AAEEH,IAAAA,KAAK,EAFP,SAAA;AAGEb,IAAAA,eAAe,EAAG,YAAA;AAChB,UAAIkB,GAAG,KAAKnB,KAAK,CAAjB,eAAA,EAAmC,OAAA,IAAA;AACnC,UAAIkB,iBAAiB,KAArB,IAAA,EAAgC,OAAA,IAAA,CAFhB,CAEgB;AAGhC;;AACA,aAAOD,SAAS,CAATA,OAAAA,CAAP,iBAAOA,CAAP;AANe,KAAC;AAHpB,GAAA,CAAA;AAnDQ,CAAA,EAAZ,SAAY,CAAZ;AAkEA,IAAII,WAAW,GAAA,aAAGC,aAAa,CAA/B,IAA+B,CAA/B;AACAD,WAAW,CAAXA,WAAAA,GAAAA,aAAAA;;AAEA,SAAA,cAAA,CAAA,SAAA,EAAA;AACE,MAAIE,OAAO,GAAGC,UAAU,CAAxB,WAAwB,CAAxB;;AACA,MAAID,OAAO,KAAX,IAAA,EAAsB;AACpB,QAAIE,GAAG,GAAG,IAAA,KAAA,CAAA,MAAA,SAAA,GAAA,2BAAA,GAAmDC,IAAI,CAAvD,IAAA,GAAV,gBAAU,CAAV;AACA,QAAIC,KAAK,CAAT,iBAAA,EAA6BA,KAAK,CAALA,iBAAAA,CAAAA,GAAAA,EAAAA,cAAAA;AAC7B,UAAA,GAAA;AACD;;AACD,SAAA,OAAA;AACD;;AAED,SAAA,YAAA,CAAA,KAAA,EAAA,MAAA,EAAA;AACE,SAAOd,KAAK,CAACD,MAAM,CAAP,IAAA,EAAA,QAAA,EAAA,KAAA,EAAZ,MAAY,CAAZ;AACD,C,CAAA;;;AAID,IAAIgB,gBAAgB,GAApB,QAAA;;SAKgBF,I,CACdG,K,EAAAA;;;AAEA,MAAIC,UAAU,GAAGC,UAAU,CAAA,YAAA,EAAe;AACxC7B,IAAAA,SAAS,EAAEL,UAAU,CADmB,MAAA;AAExCmC,IAAAA,SAAS,EAAEC,SAF6B,EAAA;AAGxCC,IAAAA,QAAQ,EAAED,SAH8B,EAAA;AAIxCnB,IAAAA,KAAK,EAJmC,EAAA;AAKxCH,IAAAA,WAAW,EAL6B,EAAA;AAMxCV,IAAAA,eAAe,EAAE;AANuB,GAAf,CAA3B;qBAQqD6B,UAAAA,CAAAA,CAAAA,C;MAA9C5B,SAAAA,GAAAA,YAAAA,CAAAA,S;MAAWgC,QAAAA,GAAAA,YAAAA,CAAAA,Q;MAAUF,SAAAA,GAAAA,YAAAA,CAAAA,S;MAAaG,QAAAA,GAAYL,UAAAA,CAAAA,CAAAA,C,CAVrDD,CAUqDC;;AAGrDM,EAAAA,cAAc,CAAA,WAAA,EAAc,UAAA,KAAA,EAAK;;;AAC/B,QAAIC,MAAM,GAAGC,KAAK,CAAlB,MAAA;AAEA,QAAIpC,SAAS,KAAKL,UAAU,CAA5B,IAAA,EAAmC;AAEnC,QAAA,CAAA,kBAAA,GAAImC,SAAS,CAAb,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAIA,kBAAAA,CAAAA,QAAAA,CAAJ,MAAIA,CAAJ,EAAyC;AACzC,QAAA,CAAA,iBAAA,GAAIE,QAAQ,CAAZ,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAIA,iBAAAA,CAAAA,QAAAA,CAAJ,MAAIA,CAAJ,EAAwC;AAExCC,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAC0C;AAApB,KAAD,CAARL;;AAEA,QAAI,CAACM,kBAAkB,CAAA,MAAA,EAASC,aAAa,CAA7C,KAAuB,CAAvB,EAAsD;AAAA,UAAA,mBAAA;;AACpDJ,MAAAA,KAAK,CAALA,cAAAA;AACA,OAAA,mBAAA,GAAA,SAAS,CAAT,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,mBAAA,CAAA,KAAA,EAAA;AACD;AAbHF,GAAc,CAAdA;AAgBA,MAAIO,IAAI,GAAGC,OAAO,CAAoB,YAAA;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE3C,SAAS,KAAKL,UAAU,CAACO;AAAjC,KAAP;AAApB,GAAA,EAAqE,CAAvF,SAAuF,CAArE,CAAlB;AAIA,SACE,KAAA,CAAA,aAAA,CAACiB,WAAW,CAAZ,QAAA,EAAA;AAAsByB,IAAAA,KAAK,EAAEhB;AAA7B,GAAA,EACE,KAAA,CAAA,aAAA,CAAA,kBAAA,EAAA;AACEgB,IAAAA,KAAK,EAAEjC,KAAK,CAAA,SAAA,GAAA,MAAA,GAAA,EAAA,EAAA,MAAA,CACThB,UAAU,CADD,IAAA,CAAA,GACSkD,KAAK,CADd,IAAA,EAAA,MAAA,CAETlD,UAAU,CAFD,MAAA,CAAA,GAEWkD,KAAK,CAFhB,MAAA,EAAA,MAAA;AADd,GAAA,EAMGC,MAAM,CAAC;AAAEnB,IAAAA,KAAK,EAAP,KAAA;AAASc,IAAAA,IAAI,EAAb,IAAA;AAAeM,IAAAA,UAAU,EAAzB,gBAAA;AAA6CC,IAAAA,IAAI,EAAE;AAAnD,GAAD,CANT,CADF,CADF;AAYD,C,CAAA;;;AAID,IAAIC,kBAAkB,GAAtB,QAAA;AAaA,IAAIC,MAAM,GAAA,aAAGC,gBAAgB,CAAC,SAAA,MAAA,CAAA,KAAA,EAAA,GAAA,EAAA;;;wBAIJC,cAAc,CAAC,CAAC5B,IAAI,CAAL,IAAA,EAAY0B,MAAM,CAAlB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAAjCpD,KAAAA,GAAAA,eAAAA,CAAAA,CAAAA,C;MAAOmC,QAAAA,GAAAA,eAAAA,CAAAA,CAAAA,C;;AACZ,MAAIH,SAAS,GAAGuB,WAAW,CAACvD,KAAK,CAAN,SAAA,EAA3B,GAA2B,CAA3B;AAEA,MAAIe,EAAE,GAAA,4BAA6ByC,KAAnC,EAAA;AACA,MAAIC,CAAC,GAAGC,cAAR,EAAA;AAEA,MAAIC,aAAa,GAAGC,WAAW,CAC7B,UAAA,KAAA,EAAA;AACE,YAAQtB,KAAK,CAAb,GAAA;AACE;AAEA,WAAKuB,IAAI,CAAT,KAAA;AACA,WAAKA,IAAI,CAAT,KAAA;AACA,WAAKA,IAAI,CAAT,SAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACAH,QAAAA,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAACgE;AAApB,SAAD,CAAR3B;AACAsB,QAAAA,CAAC,CAADA,SAAAA,CAAY,YAAA;AAAA,iBAAMtB,QAAQ,CAAC;AAAEI,YAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,YAAAA,KAAK,EAAEC,KAAK,CAACC;AAA3C,WAAD,CAAd;AAAZR,SAAAA;AACA;;AAEF,WAAKI,IAAI,CAAT,OAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACAH,QAAAA,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAACgE;AAApB,SAAD,CAAR3B;AACAsB,QAAAA,CAAC,CAADA,SAAAA,CAAY,YAAA;AAAA,iBAAMtB,QAAQ,CAAC;AAAEI,YAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,YAAAA,KAAK,EAAEC,KAAK,CAACE;AAA3C,WAAD,CAAd;AAAZT,SAAAA;AACA;AAjBJ;AAF2B,GAAA,EAsB7B,CAAA,QAAA,EAtBF,CAsBE,CAtB6B,CAA/B;AAyBA,MAAIU,WAAW,GAAGP,WAAW,CAAC,UAAA,KAAA,EAAA;AAC5B,YAAQtB,KAAK,CAAb,GAAA;AACE,WAAKuB,IAAI,CAAT,KAAA;AACE;AACA;AACA;AACAvB,QAAAA,KAAK,CAALA,cAAAA;AACA;AANJ;AAD2B,GAAA,EAA7B,EAA6B,CAA7B;AAWA,MAAI8B,WAAW,GAAGR,WAAW,CAC3B,UAAA,KAAA,EAAA;AACE,QAAIS,wBAAwB,CAAC/B,KAAK,CAAlC,aAA4B,CAA5B,EAAmD,OAAOA,KAAK,CAAZ,cAAOA,EAAP;AACnD,QAAIT,KAAK,CAAT,QAAA,EAAoB;;AACpB,QAAI7B,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAAlC,IAAA,EAAyC;AACvCsC,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAEzC,WAAW,CAAC0C;AAApB,OAAD,CAARL;AACAsB,MAAAA,CAAC,CAADA,SAAAA,CAAY,YAAA;AAAA,YAAA,qBAAA;;AAAA,eAAA,CAAA,qBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,qBAAA,CAAA,KAAA,CAA+B;AAAEa,UAAAA,aAAa,EAAE;AAAjB,SAA/B,CAAN;AAAZb,OAAAA;AAFF,KAAA,MAGO;AACLnB,MAAAA,KAAK,CAALA,cAAAA;AACAA,MAAAA,KAAK,CAALA,eAAAA;AACAH,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAEzC,WAAW,CAACgE;AAApB,OAAD,CAAR3B;AACD;AAXwB,GAAA,EAa3B,CAAA,QAAA,EAAA,CAAA,EAAA,KAAA,EAAqBN,KAAK,CAb5B,QAaE,CAb2B,CAA7B;AAgBA,MAAIc,IAAI,GAAGC,OAAO,CAAsB,YAAA;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE7C,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAACO;AAAvC,KAAP;AAAtB,GAAA,EAA6E,CAA/F,KAA+F,CAA7E,CAAlB;AAGA,MAAImE,gBAAgB,GAApB,KAAA;AACA,MAAIC,cAAc,GAAG;AACnBC,IAAAA,GAAG,EADgB,SAAA;AAEnB1D,IAAAA,EAAE,EAFiB,EAAA;AAGnBwB,IAAAA,IAAI,EAAEmC,oBAAoB,CAAA,KAAA,EAAQ1E,KAAK,CAHpB,SAGO,CAHP;AAInB,qBAJmB,IAAA;AAKnB,qBAAA,CAAA,qBAAA,GAAiBA,KAAK,CAALA,QAAAA,CAAjB,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAiBA,qBAAAA,CALE,EAAA;AAMnB,qBAAiB6B,KAAK,CAALA,QAAAA,GAAAA,SAAAA,GAA6B7B,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CANzD,IAAA;AAOnB8E,IAAAA,SAAS,EAPU,aAAA;AAQnBC,IAAAA,OAAO,EARY,WAAA;AASnBC,IAAAA,OAAO,EAAET;AATU,GAArB;AAYA,SAAOpB,MAAM,CAAC;AACZnB,IAAAA,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;AAEZc,IAAAA,IAAI,EAFQ,IAAA;AAGZM,IAAAA,UAAU,EAHE,kBAAA;AAIZC,IAAAA,IAAI,EAAE;AAJM,GAAD,CAAb;AA9EF,CAA6B,CAA7B,C,CAAA;;AAwFA,IAAI4B,iBAAiB,GAArB,KAAA;AAYA,IAAIC,mBAAmB,GAAGC,QAAQ,CAARA,cAAAA,GAA0BA,QAAQ,CAA5D,MAAA;AAEA,IAAIC,KAAK,GAAA,aAAG5B,gBAAgB,CAAC,SAAA,KAAA,CAAA,KAAA,EAAA,GAAA,EAAA;;;yBAKHC,cAAc,CAAC,CAAC5B,IAAI,CAAL,IAAA,EAAYuD,KAAK,CAAjB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAAjCjF,KAAAA,GAAAA,gBAAAA,CAAAA,CAAAA,C;MAAOmC,QAAAA,GAAAA,gBAAAA,CAAAA,CAAAA,C;;AACZ,MAAID,QAAQ,GAAGqB,WAAW,CAACvD,KAAK,CAAN,QAAA,EAA1B,GAA0B,CAA1B;AAEA,MAAIe,EAAE,GAAA,2BAA4ByC,KAAlC,EAAA;AACA,MAAI0B,iBAAiB,GAAGxB,cAAxB,EAAA;AAEA,MAAIyB,mBAAmB,GAAGC,aAA1B,EAAA;;AACA,MAAIC,OAAO,GAAI,YAAA;AACb,QAAIF,mBAAmB,KAAvB,IAAA,EAAkC;AAChC,aAAOA,mBAAmB,KAAKpC,KAAK,CAApC,IAAA;AACD;;AAED,WAAO/C,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAArC,IAAA;AALF,GAAe,EAAf;;AAQAyF,EAAAA,SAAS,CAAC,YAAA;AACR,QAAIC,SAAS,GAAGvF,KAAK,CAALA,QAAAA,CAAhB,OAAA;AACA,QAAI,CAAJ,SAAA,EAAgB;AAChB,QAAIA,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAAlC,IAAA,EAAyC;AACzC,QAAI0F,SAAS,KAAKC,QAAQ,CAA1B,aAAA,EAA0C;AAE1CD,IAAAA,SAAS,CAATA,KAAAA,CAAgB;AAAEjB,MAAAA,aAAa,EAAE;AAAjB,KAAhBiB;AANO,GAAA,EAON,CAACvF,KAAK,CAAN,SAAA,EAAkBA,KAAK,CAP1BsF,QAOG,CAPM,CAATA;AASAG,EAAAA,aAAa,CAAC;AACZF,IAAAA,SAAS,EAAEvF,KAAK,CAALA,QAAAA,CADC,OAAA;AAEZ0F,IAAAA,OAAO,EAAE1F,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAF3B,IAAA;AAGZ8F,IAAAA,MAHY,EAAA,SAAA,MAAA,CAAA,IAAA,EAAA;AAIV,UAAIC,IAAI,CAAJA,YAAAA,CAAAA,MAAAA,MAAJ,UAAA,EAA8C,OAAOC,UAAU,CAAjB,aAAA;AAC9C,UAAID,IAAI,CAAJA,YAAAA,CAAJ,MAAIA,CAAJ,EAA+B,OAAOC,UAAU,CAAjB,WAAA;AAC/B,aAAOA,UAAU,CAAjB,aAAA;AANU,KAAA;AAQZC,IAAAA,IARY,EAAA,SAAA,IAAA,CAAA,IAAA,EAAA;AASVF,MAAAA,IAAI,CAAJA,YAAAA,CAAAA,MAAAA,EAAAA,MAAAA;AACD;AAVW,GAAD,CAAbH;AAaA,MAAI9B,aAAa,GAAGC,WAAW,CAC7B,UAAA,KAAA,EAAA;AACEsB,IAAAA,iBAAiB,CAAjBA,OAAAA;;AAEA,YAAQ5C,KAAK,CAAb,GAAA;AACE;AAEA;AACA,WAAKuB,IAAI,CAAT,KAAA;AACE,YAAI7D,KAAK,CAALA,WAAAA,KAAJ,EAAA,EAA8B;AAC5BsC,UAAAA,KAAK,CAALA,cAAAA;AACAA,UAAAA,KAAK,CAALA,eAAAA;AACA,iBAAOH,QAAQ,CAAC;AAAEI,YAAAA,IAAI,EAAEzC,WAAW,CAAnB,MAAA;AAA4BgD,YAAAA,KAAK,EAAER,KAAK,CAACyD;AAAzC,WAAD,CAAf;AACD;;AACH;;AACA,WAAKlC,IAAI,CAAT,KAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACAH,QAAAA,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAC0C;AAApB,SAAD,CAARL;;AACA,YAAInC,KAAK,CAALA,eAAAA,KAAJ,IAAA,EAAoC;AAAA,cAAA,qBAAA;;AAAA,cAC5Be,GAD4B,GACrBf,KAAK,CAALA,KAAAA,CAAYA,KAAK,CADI,eACrBA,EADqB,EAAA;AAElC,WAAA,qBAAA,GAAA,QAAQ,CAAR,cAAA,CAAA,GAAA,CAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,KAAA,EAAA;AACD;;AACDgG,QAAAA,WAAW,GAAXA,SAAAA,CAAwB,YAAA;AAAA,cAAA,sBAAA;;AAAA,iBAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;AAAE1B,YAAAA,aAAa,EAAE;AAAjB,WAA/B,CAAN;AAAxB0B,SAAAA;AACA;;AAEF,WAAKnC,IAAI,CAAT,SAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACA,eAAOH,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,UAAAA,KAAK,EAAEC,KAAK,CAACiC;AAA3C,SAAD,CAAf;;AAEF,WAAKpC,IAAI,CAAT,OAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACA,eAAOH,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,UAAAA,KAAK,EAAEC,KAAK,CAACkC;AAA3C,SAAD,CAAf;;AAEF,WAAKrC,IAAI,CAAT,IAAA;AACA,WAAKA,IAAI,CAAT,MAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACA,eAAOH,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,UAAAA,KAAK,EAAEC,KAAK,CAACC;AAA3C,SAAD,CAAf;;AAEF,WAAKJ,IAAI,CAAT,GAAA;AACA,WAAKA,IAAI,CAAT,QAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACA,eAAOH,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,UAAAA,KAAK,EAAEC,KAAK,CAACE;AAA3C,SAAD,CAAf;;AAEF,WAAKL,IAAI,CAAT,MAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACAH,QAAAA,QAAQ,CAAC;AAAEI,UAAAA,IAAI,EAAEzC,WAAW,CAAC0C;AAApB,SAAD,CAARL;AACA6D,QAAAA,WAAW,GAAXA,SAAAA,CAAwB,YAAA;AAAA,cAAA,sBAAA;;AAAA,iBAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;AAAE1B,YAAAA,aAAa,EAAE;AAAjB,WAA/B,CAAN;AAAxB0B,SAAAA;AACA;;AAEF,WAAKnC,IAAI,CAAT,GAAA;AACEvB,QAAAA,KAAK,CAALA,cAAAA;AACAA,QAAAA,KAAK,CAALA,eAAAA;AACA;;AAEF;AACE,YAAIA,KAAK,CAALA,GAAAA,CAAAA,MAAAA,KAAJ,CAAA,EAA4B;AAC1BH,UAAAA,QAAQ,CAAC;AAAEI,YAAAA,IAAI,EAAEzC,WAAW,CAAnB,MAAA;AAA4BgD,YAAAA,KAAK,EAAER,KAAK,CAACyD;AAAzC,WAAD,CAAR5D;AACA+C,UAAAA,iBAAiB,CAAjBA,UAAAA,CAA6B,YAAA;AAAA,mBAAM/C,QAAQ,CAAC;AAAEI,cAAAA,IAAI,EAAEzC,WAAW,CAACqG;AAApB,aAAD,CAAd;AAA7BjB,WAAAA,EAAAA,GAAAA;AACD;;AACD;AA7DJ;AAJ2B,GAAA,EAoE7B,CAAA,QAAA,EAAA,iBAAA,EApEF,KAoEE,CApE6B,CAA/B;AAuEA,MAAIf,WAAW,GAAGP,WAAW,CAAC,UAAA,KAAA,EAAA;AAC5B,YAAQtB,KAAK,CAAb,GAAA;AACE,WAAKuB,IAAI,CAAT,KAAA;AACE;AACA;AACA;AACAvB,QAAAA,KAAK,CAALA,cAAAA;AACA;AANJ;AAD2B,GAAA,EAA7B,EAA6B,CAA7B;AAWA,MAAIK,IAAI,GAAGC,OAAO,CAAqB,YAAA;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE7C,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAACO;AAAvC,KAAP;AAArB,GAAA,EAA4E,CAA9F,KAA8F,CAA5E,CAAlB;AAGA,MAAIoE,cAAc,GAAG;AACnB,6BACExE,KAAK,CAALA,eAAAA,KAAAA,IAAAA,GAAAA,SAAAA,GAAAA,CAAAA,qBAAAA,GAA6CA,KAAK,CAALA,KAAAA,CAAYA,KAAK,CAA9DA,eAA6CA,CAA7CA,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAA6CA,qBAAAA,CAF5B,EAAA;AAGnB,uBAAA,CAAA,sBAAA,GAAmBA,KAAK,CAALA,SAAAA,CAAnB,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAmBA,sBAAAA,CAHA,EAAA;AAInBe,IAAAA,EAAE,EAJiB,EAAA;AAKnB4D,IAAAA,SAAS,EALU,aAAA;AAMnBC,IAAAA,OAAO,EANY,WAAA;AAOnBwB,IAAAA,IAAI,EAPe,MAAA;AAQnBC,IAAAA,QAAQ,EARW,CAAA;AASnB5B,IAAAA,GAAG,EAAEvC;AATc,GAArB;AAWA,MAAIqC,gBAAgB,GAApB,KAAA;AAEA,SAAOvB,MAAM,CAAC;AACZnB,IAAAA,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;AAEZc,IAAAA,IAAI,EAFQ,IAAA;AAGZM,IAAAA,UAAU,EAHE,iBAAA;AAIZqD,IAAAA,QAAQ,EAJI,mBAAA;AAKZjB,IAAAA,OAAO,EALK,OAAA;AAMZnC,IAAAA,IAAI,EAAE;AANM,GAAD,CAAb;AA5IF,CAA4B,CAA5B,C,CAAA;;AAwJA,IAAIqD,gBAAgB,GAApB,QAAA;;AAgBA,SAAA,IAAA,CAAA,KAAA,EAAA;wBAM2D1E,KAAAA,CAAnD2E,Q;MAAAA,QAAAA,GAAAA,eAAAA,KAAAA,KAAAA,CAAAA,GAAW,KAAXA,GAAW,e;MAAO3B,OAAAA,GAAiChD,KAAAA,CAAjCgD,O;MAAYN,gBAAAA,GAAAA,6BAAAA,CAAqB1C,KAArB0C,EAAqB1C,CAAAA,UAAAA,EAAAA,SAAAA,CAArB0C,C;;yBACZjB,cAAc,CAAC,CAAC5B,IAAI,CAAL,IAAA,EAAY+E,IAAI,CAAhB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAAjCzG,KAAAA,GAAAA,gBAAAA,CAAAA,CAAAA,C;MAAOmC,QAAAA,GAAAA,gBAAAA,CAAAA,CAAAA,C;;AACZ,MAAIpB,EAAE,GAAA,0BAA2ByC,KAAjC,EAAA;AACA,MAAIkD,MAAM,GAAG1G,KAAK,CAALA,eAAAA,KAAAA,IAAAA,GAAiCA,KAAK,CAALA,KAAAA,CAAYA,KAAK,CAAjBA,eAAAA,EAAAA,EAAAA,KAAjCA,EAAAA,GAAb,KAAA;AAEA2G,EAAAA,mBAAmB,CAAC,YAAA;AAClB,QAAI3G,KAAK,CAALA,SAAAA,KAAoBH,UAAU,CAAlC,IAAA,EAAyC;AACzC,QAAI,CAAJ,MAAA,EAAa;AACb,QAAI4D,CAAC,GAAGuC,WAAR,EAAA;AACAvC,IAAAA,CAAC,CAADA,SAAAA,CAAY,YAAA;AAAA,UAAA,sBAAA;;AAAA,aAAA,CAAA,sBAAA,GAAM,QAAQ,CAAR,cAAA,CAAN,EAAM,CAAN,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAN,cAAM,IAAN,IAAM,GAAN,KAAA,CAAM,GAAA,sBAAA,CAAA,cAAA,CAA8C;AAAEmD,QAAAA,KAAK,EAAE;AAAT,OAA9C,CAAN;AAAZnD,KAAAA;AACA,WAAOA,CAAC,CAAR,OAAA;AALiB,GAAA,EAMhB,CAAA,EAAA,EAAA,MAAA,EAAazD,KAAK,CANrB2G,SAMG,CANgB,CAAnBA;AAQA,MAAIE,GAAG,GAAGC,MAAM,CAA6B;AAAEN,IAAAA,QAAQ,EAARA;AAAF,GAA7B,CAAhB;AAEAG,EAAAA,mBAAmB,CAAC,YAAA;AAClBE,IAAAA,GAAG,CAAHA,OAAAA,CAAAA,QAAAA,GAAAA,QAAAA;AADiB,GAAA,EAEhB,CAAA,GAAA,EAFHF,QAEG,CAFgB,CAAnBA;AAIAA,EAAAA,mBAAmB,CAAC,YAAA;;;AAClBE,IAAAA,GAAG,CAAHA,OAAAA,CAAAA,SAAAA,GAAAA,CAAAA,sBAAAA,GAAwBrB,QAAQ,CAARA,cAAAA,CAAxBqB,EAAwBrB,CAAxBqB,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,sBAAAA,GAAwBrB,sBAAAA,CAAxBqB,WAAAA,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAAwBrB,sBAAAA,CAAxBqB,WAAwBrB,EAAxBqB;AADiB,GAAA,EAEhB,CAAA,GAAA,EAFHF,EAEG,CAFgB,CAAnBA;AAIAA,EAAAA,mBAAmB,CAAC,YAAA;AAClBxE,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAnB,YAAA;AAAkCiB,MAAAA,EAAE,EAApC,EAAA;AAAsCC,MAAAA,OAAO,EAAE6F;AAA/C,KAAD,CAAR1E;AACA,WAAO,YAAA;AAAA,aAAMA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAEzC,WAAW,CAAnB,cAAA;AAAoCiB,QAAAA,EAAE,EAAFA;AAApC,OAAD,CAAd;AAAP,KAAA;AAFiB,GAAA,EAGhB,CAAA,GAAA,EAHH4F,EAGG,CAHgB,CAAnBA;AAKA,MAAIvC,WAAW,GAAGR,WAAW,CAC3B,UAAA,KAAA,EAAA;AACE,QAAA,QAAA,EAAc,OAAOtB,KAAK,CAAZ,cAAOA,EAAP;AACdH,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAC0C;AAApB,KAAD,CAARL;AACA6D,IAAAA,WAAW,GAAXA,SAAAA,CAAwB,YAAA;AAAA,UAAA,sBAAA;;AAAA,aAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;AAAE1B,QAAAA,aAAa,EAAE;AAAjB,OAA/B,CAAN;AAAxB0B,KAAAA;AACA,QAAA,OAAA,EAAa,OAAOnB,OAAO,CAAd,KAAc,CAAd;AALY,GAAA,EAO3B,CAAA,QAAA,EAAW7E,KAAK,CAAhB,SAAA,EAAA,QAAA,EAPF,OAOE,CAP2B,CAA7B;AAUA,MAAI+G,WAAW,GAAGnD,WAAW,CAAC,YAAA;AAC5B,QAAA,QAAA,EAAc,OAAOzB,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,MAAAA,KAAK,EAAEC,KAAK,CAACgD;AAA3C,KAAD,CAAf;AACd7E,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,MAAAA,KAAK,EAAEC,KAAK,CAA1C,QAAA;AAAqDjD,MAAAA,EAAE,EAAFA;AAArD,KAAD,CAARoB;AAF2B,GAAA,EAG1B,CAAA,QAAA,EAAA,EAAA,EAHH,QAGG,CAH0B,CAA7B;AAKA,MAAI8E,UAAU,GAAGrD,WAAW,CAAC,YAAA;AAC3B,QAAA,QAAA,EAAc;AACd,QAAA,MAAA,EAAY;AACZzB,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,MAAAA,KAAK,EAAEC,KAAK,CAA1C,QAAA;AAAqDjD,MAAAA,EAAE,EAAFA;AAArD,KAAD,CAARoB;AAH0B,GAAA,EAIzB,CAAA,QAAA,EAAA,MAAA,EAAA,EAAA,EAJH,QAIG,CAJyB,CAA5B;AAMA,MAAI+E,WAAW,GAAGtD,WAAW,CAAC,YAAA;AAC5B,QAAA,QAAA,EAAc;AACd,QAAI,CAAJ,MAAA,EAAa;AACbzB,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzC,WAAW,CAAnB,QAAA;AAA8BiE,MAAAA,KAAK,EAAEC,KAAK,CAACgD;AAA3C,KAAD,CAAR7E;AAH2B,GAAA,EAI1B,CAAA,QAAA,EAAA,MAAA,EAJH,QAIG,CAJ0B,CAA7B;AAMA,MAAIQ,IAAI,GAAGC,OAAO,CAAoB,YAAA;AAAA,WAAO;AAAE8D,MAAAA,MAAM,EAAR,MAAA;AAAUF,MAAAA,QAAQ,EAARA;AAAV,KAAP;AAApB,GAAA,EAAkD,CAAA,MAAA,EAApE,QAAoE,CAAlD,CAAlB;AACA,MAAIhC,cAAc,GAAG;AACnBzD,IAAAA,EAAE,EADiB,EAAA;AAEnBqF,IAAAA,IAAI,EAFe,UAAA;AAGnBC,IAAAA,QAAQ,EAAEG,QAAQ,KAARA,IAAAA,GAAAA,SAAAA,GAAgC,CAHvB,CAAA;AAInB,qBAAiBA,QAAQ,KAARA,IAAAA,GAAAA,IAAAA,GAJE,SAAA;AAKnBA,IAAAA,QAAQ,EALW,SAAA;AAMnB3B,IAAAA,OAAO,EANY,WAAA;AAOnBsC,IAAAA,OAAO,EAPY,WAAA;AAQnBC,IAAAA,aAAa,EARM,UAAA;AASnBC,IAAAA,WAAW,EATQ,UAAA;AAUnBC,IAAAA,cAAc,EAVK,WAAA;AAWnBC,IAAAA,YAAY,EAAEL;AAXK,GAArB;AAcA,SAAOlE,MAAM,CAAC;AACZnB,IAAAA,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;AAEZc,IAAAA,IAAI,EAFQ,IAAA;AAGZM,IAAAA,UAAU,EAHE,gBAAA;AAIZC,IAAAA,IAAI,EAAE;AAJM,GAAD,CAAb;AAMD,C,CAAA;;;AAIDxB,IAAI,CAAJA,MAAAA,GAAAA,MAAAA;AACAA,IAAI,CAAJA,KAAAA,GAAAA,KAAAA;AACAA,IAAI,CAAJA,IAAAA,GAAAA,IAAAA","sourcesContent":["// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useTreeWalker } from '../../hooks/use-tree-walker'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ninterface StateDefinition {\n  menuState: MenuStates\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  itemsRef: MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n  RegisterItem,\n  UnregisterItem,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToItem; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu](state) {\n    if (state.menuState === MenuStates.Closed) return state\n    return { ...state, activeItemIndex: null, menuState: MenuStates.Closed }\n  },\n  [ActionTypes.OpenMenu](state) {\n    if (state.menuState === MenuStates.Open) return state\n    return { ...state, menuState: MenuStates.Open }\n  },\n  [ActionTypes.GoToItem]: (state, action) => {\n    let activeItemIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.items,\n      resolveActiveIndex: () => state.activeItemIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state\n    return { ...state, searchQuery: '', activeItemIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeItemIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    let nextItems = state.items.slice()\n    let currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    let idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nlet MenuContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nMenuContext.displayName = 'MenuContext'\n\nfunction useMenuContext(component: string) {\n  let context = useContext(MenuContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_MENU_TAG = Fragment\ninterface MenuRenderPropArg {\n  open: boolean\n}\n\nexport function Menu<TTag extends ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  let reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  let [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (menuState !== MenuStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (itemsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseMenu })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<MenuRenderPropArg>(() => ({ open: menuState === MenuStates.Open }), [\n    menuState,\n  ])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(menuState, {\n          [MenuStates.Open]: State.Open,\n          [MenuStates.Closed]: State.Closed,\n        })}\n      >\n        {render({ props, slot, defaultTag: DEFAULT_MENU_TAG, name: 'Menu' })}\n      </OpenClosedProvider>\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-menu-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.First }))\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last }))\n          break\n      }\n    },\n    [dispatch, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (props.disabled) return\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        event.stopPropagation()\n        dispatch({ type: ActionTypes.OpenMenu })\n      }\n    },\n    [dispatch, d, state, props.disabled]\n  )\n\n  let slot = useMemo<ButtonRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEMS_TAG = 'div' as const\ninterface ItemsRenderPropArg {\n  open: boolean\n}\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet ItemsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Items = forwardRefWithAs(function Items<TTag extends ElementType = typeof DEFAULT_ITEMS_TAG>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> &\n    PropsForFeatures<typeof ItemsRenderFeatures>,\n  ref: Ref<HTMLDivElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  let itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  let id = `headlessui-menu-items-${useId()}`\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.menuState === MenuStates.Open\n  })()\n\n  useEffect(() => {\n    let container = state.itemsRef.current\n    if (!container) return\n    if (state.menuState !== MenuStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.menuState, state.itemsRef])\n\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP\n      return NodeFilter.FILTER_ACCEPT\n    },\n    walk(node) {\n      node.setAttribute('role', 'none')\n    },\n  })\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            let { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let slot = useMemo<ItemsRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible,\n    name: 'Menu.Items',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEM_TAG = Fragment\ninterface ItemRenderPropArg {\n  active: boolean\n  disabled: boolean\n}\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onPointerMove'\n  | 'onMouseLeave'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Item<TTag extends ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n  }\n) {\n  let { disabled = false, onClick, ...passthroughProps } = props\n  let [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  let id = `headlessui-menu-item-${useId()}`\n  let active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  useIsoMorphicEffect(() => {\n    if (state.menuState !== MenuStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.menuState])\n\n  let bag = useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  let handleClick = useCallback(\n    (event: MouseEvent) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      if (onClick) return onClick(event)\n    },\n    [dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<ItemRenderPropArg>(() => ({ active, disabled }), [active, disabled])\n  let propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item',\n  })\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n"]},"metadata":{},"sourceType":"module"}